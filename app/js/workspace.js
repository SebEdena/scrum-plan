"use strict";const{ipcRenderer:ipcRenderer}=require("electron"),remote=require("electron").remote,{dialog:dialog}=remote.require("electron");let project_id=remote.getGlobal("data").current.id,scroll_state={},asked_fetch={};$(document).ready(e=>{function t(r){if(e(r).prop("id")===e(".nav-group-item.active").prop("id")&&0!==e(".tab-item").length)return;let n=e(".tab-item[id="+e(r).prop("id")+"]");if(0!==e(n).length)o(n);else{e(".tab-group").append(`\n          <div class="tab-item" id="${e(r).prop("id")}">\n          ${e(r).text()}\n          <span class="icon icon-cancel icon-close-tab"></span>\n          </div>\n          `);let n=e(".tab-item").last();n.on("click",o=>{t(e(o.target))}),n.find(".icon-close-tab").on("click",t=>{t.stopPropagation(),a(e(t.target).parent())}),o(e(".tab-item").last())}}function o(t){scroll_state[e(".nav-group-item.active").prop("id")]=e(".pane").scrollTop(),e(".active").removeClass("active"),e(t).addClass("active"),e(".nav-group-item[id="+e(t).prop("id")+"]").addClass("active"),0===e(".content-page[id="+e(t).prop("id")+"]").length&&e.get("../html/wk_contents/"+e(t).prop("id")+".html",o=>{e(".content").append(o),asked_fetch[e(t).prop("id")]=[],scroll_state[e(t).prop("id")]=0}),function(t){e(".content-page").toggle(!1),e(".content-page[id="+t+"]").toggle(!0),e(".pane").scrollTop(scroll_state[t])}(e(t).prop("id"))}function a(o){e(".tab-item").length>1&&(0===e(".tab-item").index(o)?t(e(".tab-item")[1]):t(e(".tab-item")[e(".tab-item").index(o)-1])),e(".content-page[id="+o.prop("id")+"]").toggle(!1),o.remove()}ipcRenderer.send("load",{type:"user_stories"}),ipcRenderer.send("load",{type:"sprints"}),ipcRenderer.send("load",{type:"us_sprints"}),ipcRenderer.send("load",{type:"post_its"}),ipcRenderer.send("load",{type:"dailys"}),ipcRenderer.on("loaded",(e,t)=>{t.err&&console.error("Cannot load "+t.type)}),ipcRenderer.on("error",(e,t)=>{let o="";switch(t.type){case"us":o+="The US #"+t.data.id+' : "'+t.data.feature+'" ';break;case"sprint":o+="The Sprint #"+t.data.id+" ";break;case"us_sprint":o+="The Sprint of the US #"+t.data.id+" ";break;default:return}switch(t.action){case"update":o+="could not be updated.";break;case"delete":o+="could not be deleted.";break;default:return}dialog.showMessageBox({title:"Scrum Assistant",type:"error",buttons:["Ok"],message:o},()=>{})}),e(".nav-group-item, .tab-item").on("click",function(o){t(e(this))}),e(".icon-close-tab").on("click",t=>{t.stopPropagation(),a(e(t.target).parent())}),e(".pane").on("scroll",function(){!function(t){let o=e(".pane").scrollTop();o>t.scrollTop()?t.css("top",o+"px"):t.css("top","0px")}(e(".tab-group:first"))}),t(e(".nav-group-item[id=home]"))});